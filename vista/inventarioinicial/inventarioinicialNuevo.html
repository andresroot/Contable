{{define "body" }}
<link rel="stylesheet" href="{{ .hosting }}static/css/inventario.css"/>
<link rel="stylesheet" href="{{ .hosting }}static/css/jspanel.css"/>
<script type="text/javascript" src="{{ .hosting }}static/js/jspanel.js"></script>
<script src="{{ .hosting }}static/js/jquery-ui.js"></script>
<script src="{{ .hosting }}static/js/cleave.js"></script>
<div class="container-fluid">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <h3 class="tp">Nuevo Inventario Inicial</h3>
                    <div class="col-sm-4"></div>
                    <div class="col-sm-4">
                        <div id="aviso"
                             class="alert text-center alert-success alert-dismissible"
                             role="alert" style="width: 302px; height: 40px; padding-top: 7px">
                            <button
                                    type="button"
                                    class="close"
                                    data-dismiss="alert"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <p id="textoaviso">Cargando...</p>
                        </div>
                    </div>
                    <div class="col-sm-4"></div>
                </div>
                <br>
                        <form id="formulario" method="POST"
                              action="/InventarioinicialAgregar">
                            <div class="form-group row mb-0">
                                <label class="col-sm-1 col-form-label">Documento</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0">
                                        <input type="text"
                                               name="Codigo"
                                               id="Codigo"
                                               class="form-control" required/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Fecha</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0">
                                        <input type="Date"
                                               placeholder="DD/mm/YYYY"
                                               name="Fecha"
                                               id="Fecha"
                                               class="form-control" required/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Almacenista</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0">
                                        <input type="text"
                                               name="AlmacenistaNombre"
                                               id="AlmacenistaNombre"
                                               class="form-control" required/>
                                        <input type="hidden"
                                               name="Almacenista"
                                               id="Almacenista"
                                               class="form-control"/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Centro</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0">
                                        <input type="text"
                                               name="CentroNombre"
                                               id="CentroNombre"
                                               class="form-control" required/>
                                        <input type="hidden"
                                               name="Centro"
                                               id="Centro"
                                               class="form-control"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row mb-0">
                                <table id="tabla"
                                       class="table table-sm"
                                       cellspacing="0" width="100%">
                                    <thead class="miCabeceraTabla">
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th>No</th>
                                        <th style="padding-left: 6px">Codigo</th>
                                        <th style="padding-left: 5px">Nombre Producto</th>
                                        <th style="padding-left: 5px">Unidad</th>
                                        <th style="padding-left: 15px">Iva</th>
                                        <th style="padding-left: 6px">Bodega</th>
                                        <th style="padding-left: 65px">Cantidad</th>
                                        <th style="padding-left: 50px">Vr. Unitario</th>
                                        <th style="padding-left: 100px">Total</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                            <input type="hidden" id="Subtotal19"/>
                            <input type="hidden" id="Subtotal5"/>
                            <input type="hidden" id="Subtotal0"/>
                            <input type="hidden" id="SubtotalDescuento19"/>
                            <input type="hidden" id="SubtotalDescuento5"/>
                            <input type="hidden" id="SubtotalDescuento0"/>
                            <div class="form-group row mb-0">
                                <label class="col-sm-1 col-form-label">Base
                                    19%</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0 mdo">
                                        <input type="text"
                                               id="SubtotalBase19"
                                               class="form-control text-right"/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Base
                                    5%</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0 mdo">
                                        <input type="text"
                                               id="SubtotalBase5"
                                               class="form-control text-right"/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Base 0%</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0 mdo">
                                        <input type="text"
                                               id="SubtotalBase0"
                                               class="form-control text-right"/>
                                    </div>
                                </div>
                                <label class="col-sm-1 col-form-label">Total</label>
                                <div class="col-sm-2">
                                    <div class="md-form mt-0 mdt">
                                        <input type="text"
                                               id="Total"
                                               class="form-control text-right"/>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="form-group row mb-0">
                                <div class="col-sm-12">
                                    <a href="/InventarioinicialLista"
                                       class="btn btn-outline-dark waves-effect btn-md float-right mdbi">Cancelar </a>
                                    <button type="button" id="guardar"
                                            onclick="guardardoc('Nuevo')"
                                            class="btn btn-outline-success waves-effect btn-md float-right mdbi">
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
<!--   INICIA NUEVO TERCERO-->
<input id="TerceroNuevo"
       type="hidden"/>
<input id="ProductoNuevo"
       type="hidden"/>
<input id="AlmacenistaNuevo"
       type="hidden"/>
<input id="CentroNuevo"
       type="hidden"/>
<input id="BodegaNuevo"
       type="hidden"/>
<input id="miperiodo" value="{{ .miperiodo }}"
       type="hidden"/>
<script src="{{ .hosting }}static/js/inventarioinicial.js"></script>

        {{template "inventarioinicialscript" }}
        {{template "autocompletaAlmacenista" }}
        {{template "autocompletaCentro" }}
        {{template "autocompletaBodega" }}
<script>
    $(document).ready(function () {
        // INICIA FECHA
        var m = moment().set('year', $('#miperiodo').val()).format("YYYY-MM-DD");
        $("#Fecha").val(m);
        $("#Vence").val(m);

        // INICIA CODIGO  YA EXISTE
        $("#Codigo").focus();
        $("#aviso").hide();
        $("#guardar").prop("disabled", true);
        $("#Codigo").focusout(function () {
            codigo = $("#Codigo").val().replace(" ", "_").toUpperCase();
            $("#Codigo").val(codigo);
            if ($("#Codigo").val().length > 0) {
                console.log("Handler for .keyup() called." + $("#Codigo").val());
                $.ajax({
                    url: "/InventarioinicialExiste/" + $("#Codigo").val(),
                    type: "GET",
                    dataType: "json",
                    async: false,
                    success: function (respuesta) {
                        if (respuesta.result == true) {
                            console.log(respuesta.result);
                            $("#Codigo").val("");
                            $("#textoaviso").html("El Numero Ya Existe");
                            $("#aviso").show();
                            $("#guardar").prop("disabled", true);
                        } else {
                            console.log(respuesta.result);
                            $("#aviso").hide();
                            $("#guardar").prop("disabled", false);
                        }
                    },
                });
            }
        });

        // INICIA AUTOCOMPLETADO
        autocompletaAlmacenista('#AlmacenistaNombre', '#Almacenista');
        autocompletaCentro('#CentroNombre', '#Centro');

        // INICIA FOCUS
        $('#Codigo').focus();

        // TRAE DATOS DE EDITAR
        if ("{{ .codigo }}" == "False") {
            agregar();
        } else {
            // llenar valores
            $("#Fecha").val('{{ .inventarioinicial.Fecha.Format "2006-01-02"}}');
            $('#SubtotalBase19').val('{{ .inventarioinicial.Subtotalbase19 }}');
            $('#SubtotalBase5').val('{{ .inventarioinicial.Subtotalbase5 }}');
            $('#SubtotalBase0').val('{{ .inventarioinicial.Subtotalbase0 }}');
            $('#Total').val('{{.inventarioinicial.Total }}');
            $('#Almacenista').val('{{ .inventarioinicial.Almacenista}}');
            $('#Centro').val('{{ .inventarioinicial.Centro}}');
            $('#AlmacenistaNombre').val('{{ .inventarioinicial.AlmacenistaDetalle.Nombre}}');
            $('#CentroNombre').val('{{ .Inventarioinicial.CentroDetalle.Nombre}}');
            // llenar detalle
            cont = 1;

            {{ range.detalle }}
            agregar();
            $('#seleccion_producto' + cont).val('{{ .Producto }}');
            $('#nombre' + cont).html('{{ .ProductoNombre }}');
            $('#unidad' + cont).html('{{ .ProductoUnidad }}');
            $('#iva' + cont).html('{{ .ProductoIva }}');
            $('#seleccion_bodega' + cont).val('{{ .Bodega }}');
            $('#seleccion_bodega_nombre' + cont).val('{{ .BodegaNombre }}');
            $('#cantidad' + cont).val(formatomoneda('{{ .Cantidad }}'));
            $('#valor' + cont).val(formatomoneda('{{ .Precio }}'));
            cont++;

            {{ end }}
            totales();
            $('#Codigo').focus();
            // TERMINA TRAER DATOS DE EDITAR
        }
    });

</script>
{{end}}
